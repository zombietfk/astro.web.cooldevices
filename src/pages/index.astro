---
import BaseLayout from "../layouts/BaseLayout.astro";
import SectionHeader from "../components/SectionHeader.astro";
import PostCard from "../components/PostCard.astro";
import {
    getCollection,
    type ContentEntryMap,
    type DataEntryMap,
} from "astro:content";
import type { JsxElement } from "typescript";
import type { ToneMapKey } from "../utils/toneMap";

const sortByDate = (a: any, b: any) =>
    new Date(a.data.pubDate) > new Date(b.data.pubDate) ? 1 : -1;

const getXMostRecent = 3;

const makeMostRecentPostCardsForCollection = async (
    collectionName: keyof DataEntryMap | keyof ContentEntryMap,
) =>
    (await getCollection(collectionName))
        .sort(sortByDate)
        .slice(0, getXMostRecent);

const devblogPages = await makeMostRecentPostCardsForCollection("devblog");
const tutorialsPages = await makeMostRecentPostCardsForCollection("tutorials");
const ideasPages = await makeMostRecentPostCardsForCollection("ideas");
const otherPages = await makeMostRecentPostCardsForCollection("other");
---

<BaseLayout title="CoolDevices.Online - Home">
    <h1 class="site-title">
        CoolDevices
    </h1>
    <hr />
    <div class="intro">
        <p>Welcome my personal blog, <strong>CoolDevices.Online</strong>!</p>
        <p>I am <a href="https://github.com/zombietfk"><strong>ZOMBIE‚ÅúTFK</strong></a>, aka BigCheeseTaste, aka Sam :)</p>
        <p>The goal of this blog is to document the developmet of my various personal projects, share my tutorials, ideas, and other errant thoughts!</p>
        <p>You may notice a general focus on <strong>Game Development</strong>, but will also cover some web dev and lighter computer science topics. Thank you for visiting!</p>
    </div>
    <hr />
    <SectionHeader title="Devblog Updates" tone="orange" />
    <div class="stack">
        {
            devblogPages.map((c: any) => (
                <PostCard
                    tone={"orange"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/devblog/${c.id.replace(/\.(astro|md|mdx)$/, "")}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Latest Tutorials" tone="green" />
    <div class="stack">
        {
            tutorialsPages.map((c: any) => (
                <PostCard
                    tone={"green"}
                    preview={c.data.preview}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/tutorials/${c.id.replace(/\.(astro|md|mdx)$/, "")}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Latest Ideas & Gamedev Posts" tone="cyan" />
    <div class="stack">
        {
            ideasPages.map((c: any) => (
                <PostCard
                    tone={"cyan"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/ideas/${c.id.replace(/\.(astro|md|mdx)$/, "")}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Other Posts" tone="purple" />
    <div class="stack">
        {
            otherPages.map((c: any) => (
                <PostCard
                    tone={"purple"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/other/${c.id.replace(/\.(astro|md|mdx)$/, "")}`}
                />
            ))
        }
    </div>
</BaseLayout>

<style>
    .stack {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    .featured {
        padding: 16px;
        box-shadow: none;
    }
    .row {
        display: flex;
        gap: 12px;
        align-items: flex-start;
    }
    .row i {
        color: var(--purple);
        margin-top: 2px;
    }
</style>
