---
import BaseLayout from "../layouts/BaseLayout.astro";
import SectionHeader from "../components/SectionHeader.astro";
import PostCard from "../components/PostCard.astro";
import {
    getCollection,
    type ContentEntryMap,
    type DataEntryMap,
} from "astro:content";
import type { JsxElement } from "typescript";
import type { ToneMapKey } from "../utils/toneMap";

const sortByDate = (a: any, b: any) =>
    new Date(a.data.pubDate) > new Date(b.data.pubDate) ? 1 : -1;

const getXMostRecent = 3;

const makeMostRecentPostCardsForCollection = async (
    collectionName: keyof DataEntryMap | keyof ContentEntryMap,
) =>
    (await getCollection(collectionName))
        .sort(sortByDate)
        .slice(0, getXMostRecent);

const devblogPages = await makeMostRecentPostCardsForCollection("devblog");
const tutorialsPages = await makeMostRecentPostCardsForCollection("tutorials");
const ideasPages = await makeMostRecentPostCardsForCollection("ideas");
const otherPages = await makeMostRecentPostCardsForCollection("other");
---

<BaseLayout title="Home">
    <h1 class="site-title">
        ⋅.˳˳.⋅ॱ˙˙ॱ⋅.˳˳.⋅ॱ˙˙ॱ⋅.˳˳.⋅ॱ˙˙ॱ⋅.CoolDevices.Online
    </h1>
    <hr />
    <div class="intro">
        <div>Welcome my personal blog, <span class="highlighted">CoolDevices.Online</span>!</div>
        <div>I am <a href="https://github.com/zombietfk"><span class="highlighted">ZOMBIE⁜TFK</span></a>, aka BigCheeseTaste, aka Sam :)</div>
        <div>The goal of this blog is to document the developmet of my various personal projects, share my tutorials, ideas, and other errant thoughts!</div>
        <div>You may notice a general focus on <span class="highlighted">Game Development</span>, but will also cover some web dev and lighter computer science topics. Thank you for visiting!</div>
    </div>
    <hr />
    <SectionHeader title="Devblog Updates" tone="orange" />
    <div class="stack">
        {
            devblogPages.map((c: any) => (
                <PostCard
                    tone={"orange"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/devblog/${c.id}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Latest Tutorials" tone="green" />
    <div class="stack">
        {
            tutorialsPages.map((c: any) => (
                <PostCard
                    tone={"green"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/tutorials/${c.id}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Latest Ideas & Gamedev Posts" tone="cyan" />
    <div class="stack">
        {
            ideasPages.map((c: any) => (
                <PostCard
                    tone={"cyan"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/ideas/${c.id}`}
                />
            ))
        }
    </div>
    <SectionHeader title="Other Posts" tone="purple" />
    <div class="stack">
        {
            otherPages.map((c: any) => (
                <PostCard
                    tone={"purple"}
                    title={c.data.title}
                    date={c.data.pubDate}
                    excerpt={c.data.description}
                    href={`/other/${c.id}`}
                />
            ))
        }
    </div>
</BaseLayout>

<style>
    .stack {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    .featured {
        padding: 16px;
        box-shadow: none;
    }
    .row {
        display: flex;
        gap: 12px;
        align-items: flex-start;
    }
    .row i {
        color: var(--purple);
        margin-top: 2px;
    }
    .site-title {
        margin-bottom: 1.2rem;
    }
    .intro {
        font-size: 18px !important;
        padding: 1rem 0 1rem 0;
    }
    .intro > div {
        margin: 1rem 0 1rem 0;
    }
</style>
